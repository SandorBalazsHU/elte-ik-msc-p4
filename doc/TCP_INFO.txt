√ñr√∂mmel seg√≠tek egy alapos le√≠r√°sban, ami r√©szletesen bemutatja a TCP m≈±k√∂d√©s√©t, annak k√ºl√∂nb√∂z≈ë csomagjait √©s a minim√°lis TCP logika alapjait, amelyek sz√ºks√©gesek a P4 program megval√≥s√≠t√°s√°hoz.

A le√≠r√°sban √©rinteni fogjuk a TCP k√ºl√∂nb√∂z≈ë t√≠pus√∫ csomagjait, azok fel√©p√≠t√©s√©t, valamint az alapvet≈ë m≈±k√∂d√©st, bele√©rtve a TCP h√°romutas k√©zfog√°st (handshake) √©s annak implement√°l√°s√°hoz sz√ºks√©ges inform√°ci√≥kat.
üìö TCP Protokoll: R√©szletes Ismertet≈ë
1. Mi a TCP?

A Transmission Control Protocol (TCP) egy megb√≠zhat√≥, kapcsolat-orient√°lt h√°l√≥zati protokoll, amely az alkalmaz√°sok k√∂z√∂tti adatkommunik√°ci√≥t szab√°lyozza az interneten √©s m√°s IP-alap√∫ h√°l√≥zatokban. A TCP biztos√≠tja, hogy az adatcsomagok helyes sorrendben √©rkezzenek meg, √©s hogy az elveszett vagy s√©r√ºlt csomagokat √∫jra k√ºldj√©k.

A TCP kapcsolat egy h√°roml√©pcs≈ës k√©zfog√°ssal (three-way handshake) kezd≈ëdik, majd a kapcsolat teljes √©letciklusa sor√°n sz√°mos adatcsomagot cser√©lnek az alkalmaz√°sok k√∂z√∂tt, v√©g√ºl a kapcsolat bont√°s√°val √©r v√©get.
2. TCP Csomagok √©s Flag-ek

A TCP csomagokban t√∂bbf√©le mez≈ë tal√°lhat√≥, amelyek meghat√°rozz√°k, hogy milyen t√≠pus√∫ kapcsolatot val√≥s√≠tanak meg, illetve hogy milyen m≈±veletek zajlanak a kapcsolatban. A legfontosabb mez≈ëk k√∂z√© tartozik a TCP header √©s a flag-ek.
TCP Header Fel√©p√≠t√©se

A TCP csomagok fejl√©ce (header) a k√∂vetkez≈ë f≈ëbb mez≈ëkb≈ël √°ll:
Mez≈ë neve	M√©ret	Le√≠r√°s
srcPort	16 bit	A k√ºld≈ë port sz√°ma
dstPort	16 bit	A c√©l port sz√°ma
seqNo	32 bit	A szekvenciasz√°m (mely az adatfolyam poz√≠ci√≥j√°t jel√∂li)
ackNo	32 bit	Az elismert szekvenciasz√°m (csak ha az ACK flag be van √°ll√≠tva)
dataOffset	4 bit	A TCP header hossza (az adatok kezdete a fejl√©c ut√°n)
reserved	3 bit	Rezerv√°lt mez≈ëk, amelyek mindig 0-k√©nt vannak be√°ll√≠tva
flags	9 bit	A TCP flag-ek, amelyek meghat√°rozz√°k a csomag t√≠pus√°t (pl. SYN, ACK)
window	16 bit	A k√©relmezett ablakm√©ret (a fogad√≥ buffer hely√©nek inform√°ci√≥ja)
checksum	16 bit	A hibaellen≈ërz√©shez haszn√°lt ellen≈ërz≈ë √∂sszeg
urgentPtr	16 bit	Az urgent pointer, ha a URG flag be van √°ll√≠tva
TCP Flag-ek

A TCP csomagokban tal√°lhat√≥ flags mez≈ë a k√∂vetkez≈ë z√°szl√≥kat (flag-eket) tartalmazza, amelyek a kapcsolat √°llapot√°t √©s a csomag t√≠pus√°t jel√∂lik:

    SYN (Synchronize): A h√°romutas k√©zfog√°s els≈ë l√©p√©se. A SYN flag be√°ll√≠t√°sa jelzi, hogy a k√ºld≈ë k√©sz kapcsolatot l√©tes√≠teni.

    ACK (Acknowledgment): A csomagok sikeres √°tv√©tel√©t jelzi. Az ACK flag be√°ll√≠t√°sa a szekvenciasz√°m √©s az elismert szekvenciasz√°m (ackNo) megad√°s√°val t√∂rt√©nik.

    FIN (Finish): A kapcsolat bont√°s√°hoz haszn√°lt flag.

    RST (Reset): A kapcsolat hiba miatt t√∂rt√©n≈ë √∫jraind√≠t√°s√°t jelzi.

    PSH (Push): Az adat azonnali feldolgoz√°s√°t jelzi, nem kell v√°rni a teljes bufferre.

    URG (Urgent): Urgens adatot jelez.

    ECE (ECN Echo): Az ECN (Explicit Congestion Notification) haszn√°lata.

    CWR (Congestion Window Reduced): A h√°l√≥zati forgalom szab√°lyoz√°s√°ra szolg√°l√≥ jelz√©s.

A leggyakrabban haszn√°lt flag-ek a SYN, ACK, FIN, PSH, √©s RST.
3. TCP H√°romutas K√©zfog√°s (Three-Way Handshake)

A TCP kapcsolat l√©trehoz√°sa el≈ëtt egy h√°roml√©pcs≈ës k√©zfog√°sra van sz√ºks√©g. Ez biztos√≠tja, hogy mindk√©t f√©l felk√©sz√ºlt a kapcsolat kezel√©s√©re.
1. SYN csomag k√ºld√©se

A kliens (vagy az ind√≠t√≥ f√©l) SYN csomagot k√ºld a szervernek. Ez a csomag a kapcsolat fel√©p√≠t√©s√©re ir√°nyul, √©s a k√∂vetkez≈ë flag-eket tartalmazza:

    SYN=1, ACK=0

A csomag tartalmazza a seqNo √©rt√©ket, amely az els≈ë szekvenciasz√°m, amit a kliens fel k√≠v√°n haszn√°lni.
2. SYN-ACK v√°lasz

A szerver v√°laszol egy SYN-ACK csomaggal, amelyben a k√∂vetkez≈ë flag-ek tal√°lhat√≥k:

    SYN=1, ACK=1

A seqNo √©rt√©k a szerver v√°laszt√°si szekvenciasz√°ma, m√≠g az ackNo √©rt√©k a kliens √°ltal k√ºld√∂tt seqNo + 1. Ez az elismert szekvenciasz√°m.
3. ACK v√°lasz k√ºld√©se

A kliens meger≈ës√≠ti a kapcsolat l√©trej√∂tt√©t egy ACK csomaggal. A csomag tartalmazza a seqNo √©rt√©ket, ami az el≈ëz≈ë √ºzenet folytat√°sa, √©s az ackNo √©rt√©k√©t, amely a szerver √°ltal k√ºld√∂tt szekvenciasz√°m + 1.

Ezzel a h√°rom l√©p√©ssel a TCP kapcsolat fel√©p√ºl, √©s k√©szen √°ll az adatk√ºld√©sre.
4. TCP K√ºl√∂nb√∂z≈ë Csomagt√≠pusok

A TCP protokoll az al√°bbi csomagokat haszn√°lja az adatkommunik√°ci√≥ sor√°n:
a) SYN Csomag

A SYN csomagok az els≈ë l√©p√©st jelentik a kapcsolat l√©trehoz√°sakor. Ez a csomag nem tartalmaz adatot, √©s csak a kapcsolat ind√≠t√°s√°ra szolg√°l.

SYN Csomag Fel√©p√≠t√©se:
- seqNo: Kezd≈ë szekvenciasz√°m
- ackNo: N/A
- Flags: SYN=1

b) SYN-ACK Csomag

A SYN-ACK csomag v√°lasz a SYN csomagra. Ez a csomag tartalmazza az elismert szekvenciasz√°mot √©s egy √∫j kezdeti szekvenciasz√°mot.

SYN-ACK Csomag Fel√©p√≠t√©se:
- seqNo: Szerver v√°laszt√°si szekvenciasz√°m
- ackNo: Kliens szekvenciasz√°m + 1
- Flags: SYN=1, ACK=1

c) ACK Csomag

Az ACK csomag az adat √°tv√©tel√©t jelzi, √©s tartalmazza a k√∂vetkez≈ë szekvenciasz√°mot, hogy a fogad√≥ tudja, mi az elismert adat.

ACK Csomag Fel√©p√≠t√©se:
- seqNo: Az el≈ëz≈ë √ºzenet folytat√°sa
- ackNo: Szerver szekvenciasz√°m + 1
- Flags: ACK=1

d) PSH-ACK Csomag

A PSH-ACK csomag a TCP adat√°tvitel folytat√°sa, amely a fogad√≥ sz√°m√°ra azt jelzi, hogy az adatot azonnal feldolgozni kell.

PSH-ACK Csomag Fel√©p√≠t√©se:
- seqNo: Az el≈ëz≈ë √ºzenet folytat√°sa
- ackNo: Elismert szekvenciasz√°m
- Flags: PSH=1, ACK=1

5. TCP Kapcsolat Bont√°s

A TCP kapcsolatot FIN csomagok k√ºld√©s√©vel bontj√°k. Ez is egy k√©tl√©pcs≈ës folyamat:
1. FIN csomag k√ºld√©se

A kapcsolat v√©g√©n az egyik f√©l egy FIN csomagot k√ºld, jelezve, hogy befejezte az adatk√ºld√©st.
2. ACK v√°lasz

A m√°sik f√©l meger≈ës√≠ti a FIN csomagot egy ACK v√°lasszal.
üìò √ñsszegz√©s

A TCP protokoll alapvet≈ë m≈±k√∂d√©se a kapcsolat-orient√°lt kommunik√°ci√≥n alapul. A h√°romutas k√©zfog√°s √©s az adatcsomagok, mint a SYN, SYN-ACK, ACK, PSH-ACK √©s FIN kulcsszerepet j√°tszanak a kapcsolat fel√©p√≠t√©s√©ben, fenntart√°s√°ban √©s bont√°s√°ban. A minim√°lis TCP logika implement√°l√°s√°hoz elegend≈ë a SYN, SYN-ACK, PSH-ACK t√≠pus√∫ csomagok felismer√©se √©s kezel√©s√ºk a megfelel≈ë v√°laszok k√ºld√©s√©vel.
